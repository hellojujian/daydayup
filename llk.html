<html>
<head>
</head>
<body>
<div id="content">
</div>
<script src="http://auto.sina.com.cn/js/jq172.js"></script>
<script>
var game = {};

game.pics = ['http://www.sinaimg.cn/qc/684/2009/0902/U1924P33T684D1F18649DT20091020105018.jpg',
'http://www.sinaimg.cn/qc/684/2009/0902/U1924P33T684D2F18649DT20091020105002.jpg',
'http://www.sinaimg.cn/qc/684/2009/0902/U1924P33T684D3F18649DT20091020104942.jpg',
'http://www.sinaimg.cn/qc/684/2009/0902/U1924P33T684D4F18649DT20091020104926.jpg',
'http://www.sinaimg.cn/qc/684/2009/0902/U5864P33T684D5F18649DT20110426120724.jpg',
'http://www.sinaimg.cn/qc/684/2009/0902/U1924P33T684D6F18649DT20091020104851.jpg'];
game.clickFirst = null;
game.clickSecond = null;
game.data_status = new Array();

InitGame(game.pics);

jQuery(function(){
	jQuery(".logo").on('click',function(){
		if(game.clickFirst && !game.clickSecond){
			game.clickSecond = $(this);
		}
		if(!game.clickFirst && !game.clickSecond){
			game.clickFirst = $(this);
		}
		if(game.clickFirst && game.clickSecond){
			if(game.clickFirst.find('img').attr('src') == game.clickSecond.find('img').attr('src')){
				checkLink(game.clickFirst,game.clickSecond);
			}else{
				alert('false');
			}
			game.clickFirst = game.clickSecond = null;
		}
	})
});
/*===============================================================================================*/
function InitGame(pics){
	var pairs = 2;
	var data = new Array();
	for(var i=0; i<pairs*2*pics.length; i++){
		data[i] = pics[i%6];
	}
	var data_random = new Array();
	var data_temp = new Array();
	var index = 0;
	var htmlStr = '';
	for(i=0; i<pairs*2*pics.length; i++){
		data_temp[i] = data.splice(Math.floor(Math.random()*data.length),1);
	}
	for(i=0; i<pairs*2*pics.length; i++){
		data_random[i] = data_temp[i][0];
		game.data_status[i+1] = 1;
		htmlStr += '<a class="logo" href="#" order="' + (i+1) + '"><img src="' + data_random[i] + '" /></a>';
		if(data_random.length % 6 == 0){
			htmlStr += "<br>";
		}
	}
	jQuery("#content").html(htmlStr);
}

function checkLink(objFirst, objSecond){
	//step 1: get x,y point
	coordinateFirst = getCoordinate(objFirst.attr('order'));
	coordinateSecond= getCoordinate(objSecond.attr('order'));
	//step 2: check link
	if(coordinateFirst.x == coordinateSecond.x){
		if(Math.abs(coordinateFirst.y - coordinateSecond.y) == 1){
			alert('ok');
			game.data_status[(coordinateFirst.y-1)*6+coordinateFirst.x] = 0;
			game.data_status[(coordinateSecond.y-1)*6+coordinateSecond.x] = 0;
			return;
		}
		//try left
		var left_path = false;
		for(var i=coordinateFirst.x-1; i>=0; i--){
			if(i == 0){
				left_path = true;
				alert('ok');
				game.data_status[(coordinateFirst.y-1)*6+coordinateFirst.x] = 0;
				game.data_status[(coordinateSecond.y-1)*6+coordinateSecond.x] = 0;
				return;
			}

			if(!game.data_status[(coordinateFirst.y-1)*6+coordinateFirst.x] && !game.data_status[(coordinateSecond.y-1)*6+coordinateSecond.x]){
				var y_small = coordinateFirst.y > coordinateSecond.y ? coordinateSecond.y : coordinateFirst.y;
				var y_big = coordinateFirst.y > coordinateSecond.y ? coordinateFirst.y : coordinateSecond.y;
				left_path = true;
				for(var j=y_small+1; j<=y_big-1; j++){
					if(game.data_status[(j-1)*6+i]){
						left_path = false;
						break;
					}
				}
			}
			if(left_path){
				alert('ok');
				return;
			}

			
			if(game.data_status[(coordinateFirst.y-1)*6+coordinateFirst.x] || game.data_status[(coordinateSecond.y-1)*6+coordinateSecond.x]){
				alert('false');
				return;
			}
		}
		
	}	

	if(coordinateFirst.y == coordinateSecond.y){
		if(Math.abs(coordinateFirst.x - coordinateSecond.x) == 1){
			alert('ok');
			game.data_status[(coordinateFirst.y-1)*6+coordinateFirst.x] = 0;
			game.data_status[(coordinateSecond.y-1)*6+coordinateSecond.x] = 0;
			return;
		}
	}
	

	 
}

function getCoordinate(x){
	var line = Math.ceil(x/6);
	var column = x%6;
	if(column == 0){
		column = 6;
	}
	return {x:column,y:line};
}

function checkLeft(first,second){
	//same column
	var x_min = Math.min(first.x, second.x);
	var x_max = Math.max(first.x, second.x);
	var y_min = Math.min(first.y, second.y);				
	var y_max = Math.max(first.y, second.y);				
	if(first.x != second.x){
		if((second.y-first.y)/(second.x-first.x) > 0){
			if(checkLine(x_min, y_max, x_max, y_max)){
				if(checkLine(x_min, y_min, x_min, y_max)){
					return true;
				}else{
					var checkContinue = true;
				}
			}
		}else{
			var line = checkLine(x_min, y_min, x_max, y_min);
			if(checkLine(x_min, y_min, x_max, y_min)){
				if(checkLine(x_min, y_min, x_min, y_max)){
					return true;
				}else{
					var checkContinue = true;
				}
			}
		}

		//若横向的一条线可以连通，则进入在同一列这种情况的判断
		if(checkContinue){
			first.x = second.x = x_min;
		}
	}
	if(first.x == second.x){
		if(x == 1){
			return true;
		}else{
			for(var i=x-1; i>=0; i--){
				if(!game.data_status[(first.y-1)*6+first.x] && !game.data_status[(second.y-1)*6+second.x]){
					for(var j=y_min+1; j<=y_max; j++){
						if(game.data_status[(j-1)*6+i]){
							return false;
						}
					}
				}
			}
			return true;
		}
	}
	return false;
}

function checkRight(first,second){

}

function checkTop(first,second){

}

function checkBottom(first,second){
	
}

/*
 * check point (x_start,y_start) (x_end, y_end) 
 */
function checkLine(x_start, y_start, x_end, y_end){
	var path = true;
	if(x_start == x_end){
		var y_min = Math.min(y_start, y_end);	
		var y_max = Math.max(y_start, y_end);	
		for(var i=y_min; i++; i<=y_max){
			if(game.data_status[(i-1)*6+x_start]){
				path = false;
				break;
			}
		}
		return path;
	}
	if(y_start == y_end){
		var x_min = Math.min(x_start, x_end);
		var x_max = Math.max(x_start, x_end);
		for(var i=x_min; i++; i<=x_max){
			if(game.data_status[(y_start-1)*6+i]){
				path = false;
				break;
			}
		}
		return path;
	}
	return false;
}
</script>
</body>
</html>
